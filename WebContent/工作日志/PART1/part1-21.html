<!DOCTYPE html>

<head>
        <meta charset="utf-8">
        <title>21-团支部获奖情况记录</title>
        <link type="text/css" href="../styles/part1/21.css" rel="stylesheet">
        <link type="text/css" href="../styles/all.css" rel="stylesheet">
</head>

<body>
        <!-- 注册团员名单 -->
        <div>
                <div class="title">
                        <div class="title-circle">
                                <span>7</span>
                        </div>
                        <div class="title-words">
                                <p class="font-1">团支部获奖情况记录</p>
                                <p class="font-2">AWARDS OF THE LEAGUE</p>
                        </div>
                </div>
                <div>
                        <table class="table-else" cellspacing="1" cellpadding="4" id="part1-21-list">
                                <tr>
                                        <th style="color: #255e95;">奖项名称</th>
                                        <th style="color: #255e95;">奖项级别</th>
                                        <th style="color: #255e95;">获奖时间</th>
                                        <th style="color: #255e95;">奖项类别</th>
                                </tr>
                                <tr>
                                        <td contentEditable="true">1</td>
                                        <td contentEditable="true">1</td>
                                        <td contentEditable="true">1</td>
                                        <td contentEditable="true">1</td>
                                </tr>
                                <tr>
                                        <td contentEditable="true">1</td>
                                        <td contentEditable="true">1</td>
                                        <td contentEditable="true">1</td>
                                        <td contentEditable="true">1</td>
                                </tr>
                                <tr>
                                        <td contentEditable="true">1</td>
                                        <td contentEditable="true">1</td>
                                        <td contentEditable="true">1</td>
                                        <td contentEditable="true">1</td>
                                </tr>
                                <tr>
                                        <td contentEditable="true">1</td>
                                        <td contentEditable="true">1</td>
                                        <td contentEditable="true">1</td>
                                        <td contentEditable="true">1</td>
                                </tr>
                                <tr>
                                        <td contentEditable="true">1</td>
                                        <td contentEditable="true">1</td>
                                        <td contentEditable="true">1</td>
                                        <td contentEditable="true">1</td>
                                </tr>
                                <tr>
                                        <td contentEditable="true">1</td>
                                        <td contentEditable="true">1</td>
                                        <td contentEditable="true">1</td>
                                        <td contentEditable="true">1</td>
                                </tr>
                                <tr>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                </tr>
                                <tr>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                </tr>
                                <tr>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                </tr>
                                <tr>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                </tr>
                                <tr>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                </tr>
                                <tr>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                </tr>
                                <tr>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                </tr>
                                <tr>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                </tr>
                                <tr>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                </tr>
                                <tr>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                </tr>
                                <tr>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                </tr>
                                <tr>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                </tr>
                                <tr>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                </tr>
                                <tr>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                        <td contentEditable="true"></td>
                                </tr>
                        </table>
                        <div style="width: 100px; margin: auto;">
                                <input type="image" src="../images/add.png"
                                        style="width: 100px;height: 100px; margin: auto 0;text-align: center;outline: none;"
                                        onclick="addTable()">
                        </div>
                        <div class="buttons">
                                <button id="submit">提交</button>
                        </div>
                </div>
</body>
<script src="../scripts/jquery.js"></script>
<script>
        var Class = sessionStorage.getItem("class");
        var theTable = document.getElementById("part1-21-list");

        window.onload = function () {
                showList();
        }

        function showList() {
                theTable.innerHTML = "";
                $.ajax({
                        type: "POST",
                        url: "servlet/part1_21",
                        data: {
                                "Class": Class,
                                "flag": 0
                        },
                        success: function (data, status) {
                                var tr1 = document.createElement('tr');
                                var th1 = document.createElement('th');
                                th1.style.color = "#255e95";
                                th1.innerText = "奖项名称";
                                var th2 = document.createElement('th');
                                th2.style.color = "#255e95";
                                th2.innerText = "奖项级别";
                                var th3 = document.createElement('th');
                                th3.style.color = "#255e95";
                                th3.innerText = "获奖时间";
                                var th4 = document.createElement('th');
                                th4.style.color = "#255e95";
                                th4.innerText = "奖项类别";

                                tr1.append(th1);
                                tr1.append(th2);
                                tr1.append(th3);
                                tr1.append(th4);

                                theTable.append(tr1);

                                for (var i = 0; i < data.size; i++) {
                                        var awardTr = document.createElement('tr');
                                        var awardName = document.createElement('td');
                                        awardName.contentEditable = true;
                                        awardName.innerText = data.array[i].awardName;
                                        var awardLevel = document.createElement('td');
                                        awardLevel.contentEditable = true;
                                        awardLevel.innerText = data.array[i].awardLevel;
                                        var awardDate = document.createElement('td');
                                        awardDate.contentEditable = true;
                                        awardDate.innerText = data.array[i].awardDate;
                                        var awardCategory = document.createElement('td');
                                        awardCategory.contentEditable = true;
                                        awardCategory.innerText = data.array[i].awardCategory;

                                        awardTr.append(awardName);
                                        awardTr.append(awardLevel);
                                        awardTr.append(awardDate);
                                        awardTr.append(awardCategory);

                                        theTable.append(awardTr);
                                }

                                for (var j = 0; j < 5; j++) {
                                        var newTr = document.createElement("tr");
                                        for (i = 0; i < 4; i++) {
                                                var newTd = document.createElement("td");
                                                newTd.contentEditable = true;
                                                newTr.appendChild(newTd);
                                        }
                                        theTable.appendChild(newTr);
                                }
                        },
                        error: function (data, status) {
                                alert("出错啦，快找管理员处理把");
                        }
                });
        }

        function submit() {
                var array = [];
                var rows = theTable.rows;                           // 获取表格所有行
                for (var i = 1; i < rows.length; i++) {
                        var flag = true;
                        var awardItem = {};
                        if (rows[i].cells[0] == "" && rows[i].cells[1] == "" && rows[i].cells[2] == "" && rows[i].cells[3] == "") {
                                flag = false;
                        }
                        awardItem["awardName"] = rows[i].cells[0].innerText;
                        awardItem["awardLevel"] = rows[i].cells[1].innerText;
                        awardItem["awardDate"] = rows[i].cells[2].innerText;
                        awardItem["awardItem"] = rows[i].cells[3].innerText;

                        if (flag) {
                                array.push(awardItem);
                        }
                }

                var jsonArray = JSON.stringify(array);

                $.ajax({
                        type: "POST",
                        url: "servlet/part1_21",
                        data: {
                                "flag": 1,
                                "Class": Class,
                                "array": jsonArray
                        },
                        success: function (data, status) {
                                showList();
                        },
                        error: function (data, status) {
                                console.log("出错啦，去找管理员处理把");
                        }
                });

        }

        function addTable() {
                var newTr = document.createElement("tr");
                for (i = 0; i < 4; i++) {
                        var newTd = document.createElement("td");
                        newTd.contentEditable = true;
                        newTr.appendChild(newTd);
                }
                theTable.appendChild(newTr);
        }

        $(window).bind('beforeunload', function () {
                submit();
        });
</script>


</html>