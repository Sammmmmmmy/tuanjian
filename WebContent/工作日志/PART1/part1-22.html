<!DOCTYPE html>

<head>
        <meta charset="utf-8">
        <title>22-支部团员奖惩记录</title>
        <link type="text/css" href="../styles/part1/22.css" rel="stylesheet">
        <link type="text/css" href="../styles/all.css" rel="stylesheet">
</head>

<body>
        <!-- 注册团员名单 -->
        <div>
                <div class="title">
                        <div class="title-circle">
                                <span>8</span>
                        </div>
                        <div class="title-words">
                                <p class="font-1">支部团员奖惩记录</p>
                                <p class="font-2">STUDENTS MERITS AND PUNISHMENT</p>
                        </div>
                </div>
                <table class="table-else" cellspacing="1" cellpadding="4" id="part1-22-list">
                        <tr>
                                <th style="color: #255e95;">获奖|受惩人姓名</th>
                                <th style="color: #255e95;">奖惩内容</th>
                                <th style="color: #255e95;">级别</th>
                                <th style="color: #255e95;">时间</th>
                                <th style="color: #255e95;">类别</th>
                        </tr>
                        <tr>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                        </tr>
                        <tr>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                        </tr>
                        <tr>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                        </tr>
                        <tr>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                        </tr>
                        <tr>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                        </tr>
                        <tr>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                                <td contentEditable="true">1</td>
                        </tr>
                        <tr>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                        </tr>
                        <tr>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                        </tr>
                        <tr>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                        </tr>
                        <tr>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                        </tr>
                        <tr>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                        </tr>
                        <tr>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                        </tr>
                        <tr>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                        </tr>
                        <tr>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                        </tr>
                        <tr>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                        </tr>
                        <tr>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                        </tr>
                        <tr>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                        </tr>
                        <tr>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                        </tr>
                        <tr>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                        </tr>
                        <tr>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                                <td contentEditable="true"></td>
                        </tr>
                </table>

                <div style="width: 100px; margin: auto;">
                        <input type="image" src="../images/add.png"
                                style="width: 100px;height: 100px; margin: auto 0;text-align: center;outline: none;"
                                onclick="addTable()">
                </div>

                <div class="buttons">
                        <button id="submit">提交</button>
                </div>
        </div>
</body>
<script src="../scripts/jquery.js"></script>
<script>
        var Class = sessionStorage.getItem("class");
        var theTable = document.getElementById("part1-22-list");

        window.onload = function () {
                showList();
        }

        function showList() {
                theTable.innerHTML = "";
                $.ajax({
                        type: "POST",
                        url: "servlet/part1_22",
                        data: {
                                "Class": Class,
                                "flag": 0
                        },
                        success: function (data, status) {
                                var tr1 = document.createElement('tr');
                                var th1 = document.createElement('th');
                                th1.style.color = "#255e95";
                                th1.innerText = "获奖|受惩人姓名";
                                var th2 = document.createElement('th');
                                th2.style.color = "#255e95";
                                th2.innerText = "奖惩内容";
                                var th3 = document.createElement('th');
                                th3.style.color = "#255e95";
                                th3.innerText = "级别";
                                var th4 = document.createElement('th');
                                th4.style.color = "#255e95";
                                th4.innerText = "时间";
                                var th5 = document.createElement('th');
                                th5.style.color = "#255e95";
                                th5.innerText = "类别";

                                tr1.append(th1);
                                tr1.append(th2);
                                tr1.append(th3);
                                tr1.append(th4);
                                tr1.append(th5);

                                theTable.append(tr1);

                                for (var i = 0; i < data.size; i++) {
                                        var tr2 = document.createElement('tr');
                                        var td1 = document.createElement('td');
                                        td1.contentEditable = true;
                                        td1.innerText=data.array[i].stuMPName;
                                        var td2 = document.createElement('td');
                                        td2.contentEditable = true;
                                        td2.innerText=data.array[i].MPContent;
                                        var td3 = document.createElement('td');
                                        td3.contentEditable = true;
                                        td3.innerText=data.array[i].MPLevel;
                                        var td4 = document.createElement('td');
                                        td4.contentEditable = true;
                                        td4.innerText=data.array[i].MPDate;
                                        var td5 = document.createElement('td');
                                        td5.contentEditable = true;
                                        td5.innerText=data.array[i].MPCategory;

                                        tr2.append(td1);
                                        tr2.append(td2);
                                        tr2.append(td3);
                                        tr2.append(td4);
                                        tr2.append(td5);


                                        theTable.append(tr2);
                                }

                                for (var j = 0; j < 5; j++) {
                                        var newTr = document.createElement("tr");
                                        for (i = 0; i < 5; i++) {
                                                var newTd = document.createElement("td");
                                                newTd.contentEditable = true;
                                                newTr.appendChild(newTd);
                                        }
                                        theTable.appendChild(newTr);
                                }
                        },
                        error: function (data, status) {
                                alert("出错啦，快找管理员处理把");
                        }
                });
        }

        function submit() {
                var array = [];
                var rows = theTable.rows;                           // 获取表格所有行
                for (var i = 1; i < rows.length; i++) {
                        var flag = true;
                        var MPItem = {};
                        if (rows[i].cells[0] == "" && rows[i].cells[1] == "" && rows[i].cells[2] == "" && rows[i].cells[3] == "" && rows[i].cells[4] == "") {
                                flag = false;
                        }
                        MPItem["stuMPName"] = rows[i].cells[0].innerText;
                        MPItem["MPContent"] = rows[i].cells[1].innerText;
                        MPItem["MPLevel"] = rows[i].cells[2].innerText;
                        MPItem["MPDate"] = rows[i].cells[3].innerText;
                        MPItem["MPCategory"] = rows[i].cells[3].innerText;

                        if (flag) {
                                array.push(MPItem);
                        }
                }

                var jsonArray = JSON.stringify(array);

                $.ajax({
                        type: "POST",
                        url: "servlet/part1_22",
                        data: {
                                "flag": 1,
                                "Class": Class,
                                "array": jsonArray
                        },
                        success: function (data, status) {
                                showList();
                        },
                        error: function (data, status) {
                                console.log("出错啦，去找管理员处理把");
                        }
                });

        }

        function addTable() {
                var newTr = document.createElement("tr");
                for (i = 0; i < 5; i++) {
                        var newTd = document.createElement("td");
                        newTd.contentEditable = true;
                        newTr.appendChild(newTd);
                }
                theTable.appendChild(newTr);
        }

        $(window).bind('beforeunload', function () {
                submit();
        });


</script>

</html>